<!doctype html>
<html lang="en">


  <head>
	<title>BTPrefab</title>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href=  "/assets/style.css">
	<link rel="stylesheet" href="/assets/progbar.css">
	<link rel="stylesheet" href= "/assets/bootstrap-4.1.3/css/bootstrap-grid.css">
  </head>

  <body>

      <div class="container-fluid">

          <div class="row">
              <div class="col padding-col">
                  &nbsp;
              </div>
          </div>

          <div class="row">
              <div class="col-md-10">

                  <div class="row">
                      <div class="col-md-5">
                          <img src="/assets/images/bt_logo.png" class="logo" alt="Baker Triangle" title="Baker Triangle">
                      </div>
                      <div class="col-md-7 text-left">
                          <h2 class="text-center name" id="project-name">
                              PROJECT NAME
                          </h2>
                      </div>
                  </div>

                  <div class="row">
                      <div class="d-xs-none d-sm-none d-md-block col-md-1">
                          &nbsp;
                      </div>
                      <div class="col-xs-12 col-sm-12 col-md-11">

                          <div class="row">
                              <div class="col-md-9">
                                  <div class="row">
                                      <div class="col">
                                          <span>&nbsp;</span>
                                      </div>
                                  </div>
                                  <div class="row">
                                      <div class="col-md-7 padding-col">
                                          <span class="title1" style="font-weight: bold;"> LINE </span>
                                      </div>
                                      <div class="col-md-5 padding-col nopadding" align="left">
                                          <span class="number2" id="line-progress">&nbsp&nbsp0</span>
                                          <span class="title2">&nbsp&nbspof&nbsp</span>
                                          <span class="number2" id="line-projection">&nbsp&nbsp0</span>
                                      </div>
                                  </div>
                                  <div class="row">
                                      <div class="col-md-7 padding-col">
                                          <span class="title2" style="font-stretch: condensed;"> WEEKLY&nbsp&nbspFORECAST </span>
                                      </div>
                                      <div class="col-md-5 padding-col nopadding" align="left">
                                          <span class="number2" id="week-progress">&nbsp&nbsp0</span>
                                          <span class="title2">&nbsp&nbspof&nbsp</span>
                                          <span class="number2" id="week-projection">&nbsp&nbsp0</span>
                                      </div>
                                  </div>
                                  <div class="row">
                                      <div class="col-md-7 padding-col">
                                          <span class="title1" style="font-stretch: condensed;"> PROJECT STATUS </span>
                                      </div>
                                      <div class="col-md-5 padding-col nopadding" align="left">
                                          <span class="number2" id="total-progress">&nbsp&nbsp0</span>
                                          <span class="title2">&nbsp&nbspof&nbsp</span>
                                          <span class="number2" id="total-projection">&nbsp&nbsp0</span>
                                      </div>
                                  </div>

                                  <div class="row justify-content-end">
                                      <div class="col-md-5">
                                          <div class="row justify-content-end">
                                              <div id="comic" style="visibility: hidden">
                                                  <img src="/assets/images/comic.png" class="logo" alt="comic" title="Zach Talk">
                                              </div>
                                          </div>
                                      </div>
                                  </div>

                        
                                 <div class="row">
                                     <div class="col-xs-12 col-md-6">
                                         <span class="title4" id="current-day"> DAY&nbsp;&nbsp;&nbsp;0 of&nbsp;&nbsp;&nbsp;0 </span>
                                     </div>
                                     <div class="col-xs-12 col-md-6">
                                         <span class="title4">
                                             Time &nbsp;&nbsp;&nbsp; <span id='clock'></span>
                                         </span>
                                     </div>
                                </div>



                              </div>

                              <div class="col-md-3">
                                  <div class="row justify-content-center" id="pause-row" style="background-color:red; color:white">
                                      <div class="pause-show">
                                          <span id="pause-txt">PAUSE</span>
                                      </div>
                                  </div>

                                  <div class="row">
                                      <div class="col padding-col">
                                          &nbsp;
                                      </div>
                                  </div>
                                  <div class="row">
                                      <div class="col">
                                          &nbsp;
                                      </div>
                                  </div>

                                  <div class="row justify-content-end">
                                      <div id="zach" style="visibility: hidden">
                                          <img src="/assets/images/zach.gif" class="logo" alt="zach" title="Zach Smile">
                                      </div>
                                  </div>


                              </div>
                          </div>
                      </div>
                  </div>

              </div>

              <div class="col-md-2">
                  <div id="myProgress">
                      <div id="myBar">&nbsp;</div>
                  </div>
              </div>
          </div>

      </div>



    <audio id="warning-1" preload="auto">
        <source src="/assets/sounds/alarm1.wav" />
        <source src="/assets/sounds/alarm1.mp3" />
        AUDIO FORMAT NOT SUPPORTED
    </audio>
    <audio id="warning-2" preload="auto">
        <source src="/assets/sounds/alarm2.wav" />
        <source src="/assets/sounds/alarm2.mp3" />
        AUDIO FORMAT NOT SUPPORTED
    </audio>
    <audio id="warning-3" preload="auto">
        <source src="/assets/sounds/alarm3.wav" />
        <source src="/assets/sounds/alarm3.mp3" />
        AUDIO FORMAT NOT SUPPORTED
    </audio>



      <input type="hidden" id="btn_test" value="RESUME">
      <input type="hidden" value="" id="hdn_pros_interval">
      <input type="hidden" value="" id="hdn_ms_remaind">
      <input type="hidden" value="0" id="hdn_keep_height">
      <input type="hidden" value="60" id="takt-time">
      <!-- Value must be 0 to keep last height state-->

      <script type="text/javascript">
          var times = document.getElementById('clock');

          function time() {
              var d = new Date();
              var s = d.getSeconds();
              var m = d.getMinutes();
              var h = d.getHours();
              times.textContent = FormatNumber(h, 2, "0") + ":" + FormatNumber(m, 2, "0") + ":" + FormatNumber(s, 2, "0");
          }
          setInterval(time, 1000);
      </script>

      <script type="text/javascript">
          function set_pause(status) {
              if (status == 1)
                  document.getElementById("pause-btn").style.visibility = "visible";
              if (status == 0)
                  document.getElementById("pause-btn").style.visibility = "hidden";
          }
      </script>

      <script type="text/javascript">
          function test() {

              var btnvalue = document.getElementById("btn_test").value;

              if (btnvalue == "PAUSE") {
                  set_pause(1);
                  document.getElementById("btn_test").value = "RESUME";
                  stopProgress();

              } else {
                  set_pause(0);
                  document.getElementById("btn_test").value = "PAUSE";
                  startProgress();
              }

          }
      </script>

      <script type="text/javascript">
          function startProgress() {
              var total_ = document.getElementById("takt-time").value;
              total_ms = parseInt(total_) * 60 * 1000;
              frame_ms = total_ms / 100;
              doProgress(frame_ms, 0);
          }

          function stopProgress() {
              clearInterval(document.getElementById("hdn_pros_interval").value)
          }


          function doProgress(frame_ms) {

              var elem = document.getElementById("myBar");
              var height = document.getElementById("hdn_keep_height").value;
              var id = setInterval(frame, frame_ms); //1000 ms = 1 second   when set to 1000 means each 1 second reduce 1 frame
              //each frame 600, it takes 1 minute

              document.getElementById("hdn_pros_interval").value = id; //keep id , in order to access the interval during the run time

              function frame() {
                  if (height > 100) {
                      resetProgress();
                      height = 0;
                      //clearInterval(id);
                  } else {
                      height++;
                      elem.style.height = height + '%';
                      if (height >= 80) {
                          document.getElementById("myProgress").style.backgroundColor = "#FF0000"
                      }
                  }

                  document.getElementById("hdn_keep_height").value = height;
              }
          }

          function resetProgress() {
              document.getElementById("hdn_keep_height").value = 0;
              var elem = document.getElementById("myBar");
              elem.style.height = 0;
              document.getElementById("myProgress").style.backgroundColor = "#003399"
          }
      </script>

      <script type="text/javascript">
          function FormatNumber(num, length, char) {
              var r = "" + num;
              while (r.length < length) {
                  r = char + r;
              }
              return r;
          }
      </script>

      <script src="/socket.io/socket.io.js"></script>
      <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
      <script>
          $(function () {
              var socket = io();

              socket.on('update', function (data) {

                  var json = JSON.parse(data)
                  document.getElementById("project-name").innerHTML = json.projectName;
                  document.getElementById("line-progress").innerHTML = FormatNumber(json.finished_Today, 3, "\xa0");
                  document.getElementById("line-projection").innerHTML = FormatNumber(json.paced, 3, "\xa0");
                  document.getElementById("week-progress").innerHTML = FormatNumber(json.finished_Week, 3, "\xa0");
                  document.getElementById("week-projection").innerHTML = FormatNumber(json.projected_Week, 3, "\xa0");
                  document.getElementById("total-progress").innerHTML = FormatNumber(json.finished_Total, 3, "\xa0");
                  document.getElementById("total-projection").innerHTML = FormatNumber(json.totalPanel, 3, "\xa0");
                  document.getElementById("current-day").innerHTML = " Day " + FormatNumber(json.currentDay, 3, "\xa0") + " of " + FormatNumber(json.totalDuration, 3, "\xa0" + " ");
                  document.getElementById("takt-time").value = json.taktTime;


                  var minsLeft = Math.floor(json.value / 60).toString() + " min";
                  var height = 100 - (json.value * 100 / (json.taktTime * 60));
                  //var height = 100 - json.value;
                  document.getElementById("myBar").style.height = height + '%';
                  if (height >= 80) {
                      document.getElementById("myProgress").style.backgroundColor = "#FF0000";
                      document.getElementById("zach").style.visibility = "visible";
                      document.getElementById("comic").style.visibility = "visible";
                  } else {
                      document.getElementById("myProgress").style.backgroundColor = "#003399";
                      document.getElementById("zach").style.visibility = "hidden";
                      document.getElementById("comic").style.visibility = "hidden";
                  }

                  var pause = json.pause;
                  if (pause == true) {
                      //document.getElementById("pause-btn").style.visibility = "visible";
                      document.getElementById("pause-row").style.backgroundColor = "#FF0000";
                      document.getElementById("pause-row").style.color = "#FFFFFF";
                      document.getElementById("pause-txt").innerHTML = "PAUSE";
                  } else {
                      //document.getElementById("pause-btn").style.visibility = "hidden";
                      document.getElementById("pause-row").style.backgroundColor = "#FFFFFF";
                      document.getElementById("pause-row").style.color = "#000000";
                      document.getElementById("pause-txt").innerHTML = minsLeft.toString();
                  }

                  var warning = json.warning;

                  if (warning !== 0) {
                      var audio = document.getElementById("warning-" + warning);
                      audio.play();
                  }

                  //$('#messages').append($('<li>').text(data));
              });

              socket.on('pause', function () {

              });

              socket.on('reset', function () {
                  //resetProgress();
              });
          });
      </script>


  </body>
</html>
